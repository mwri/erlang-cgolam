-module(cgolam_rules_species1_tests_SUITE).


-compile(export_all).


-include_lib("common_test/include/ct.hrl").


all() -> [
	test_calc
].


suite() ->
	[{timetrap, {seconds,30}}, {logdir, "logs"}]
.


-define(calc_expectations, [

		{false, [
			]},

		{false, [
			{{-1,-1}, {col,{255,0,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{255,0,0}}}
			]},
		{{col,{255,0,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{255,0,0}}},
			{{0,0},   {col,{255,0,0}}}
			]},
		{{col,{255,0,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{255,0,0}}},
			{{1,-1},  {col,{255,0,0}}}
			]},
		{{col,{255,0,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{255,0,0}}},
			{{1,-1},  {col,{255,0,0}}},
			{{0,0},   {col,{255,0,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{255,0,0}}},
			{{1,-1},  {col,{255,0,0}}},
			{{-1,0},  {col,{255,0,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{255,0,0}}},
			{{1,-1},  {col,{255,0,0}}},
			{{-1,0},  {col,{255,0,0}}},
			{{0,0},   {col,{255,0,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{255,0,0}}},
			{{1,-1},  {col,{255,0,0}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{255,0,0}}}
			]},

		{false, [
			{{-1,-1}, {col,{0,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{0,255,0}}},
			{{0,-1},  {col,{0,255,0}}}
			]},
		{{col,{0,255,0}}, [
			{{-1,-1}, {col,{0,255,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{0,0},   {col,{0,255,0}}}
			]},
		{{col,{0,255,0}}, [
			{{-1,-1}, {col,{0,255,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,255,0}}}
			]},
		{{col,{0,255,0}}, [
			{{-1,-1}, {col,{0,255,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,255,0}}},
			{{0,0},   {col,{0,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{0,255,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,255,0}}},
			{{-1,0},  {col,{0,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{0,255,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,255,0}}},
			{{-1,0},  {col,{0,255,0}}},
			{{0,0},   {col,{0,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{0,255,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,255,0}}},
			{{-1,0},  {col,{0,255,0}}},
			{{1,0},   {col,{0,255,0}}}
			]},

		{false, [
			{{-1,-1}, {col,{255,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,255,0}}},
			{{0,-1},  {col,{255,255,0}}}
			]},
		{{col,{255,255,0}}, [
			{{-1,-1}, {col,{255,255,0}}},
			{{0,-1},  {col,{255,255,0}}},
			{{0,0},   {col,{255,255,0}}}
			]},
		{{col,{255,255,0}}, [
			{{-1,-1}, {col,{255,255,0}}},
			{{0,-1},  {col,{255,255,0}}},
			{{1,-1},  {col,{255,255,0}}}
			]},
		{{col,{255,255,0}}, [
			{{-1,-1}, {col,{255,255,0}}},
			{{0,-1},  {col,{255,255,0}}},
			{{1,-1},  {col,{255,255,0}}},
			{{0,0},   {col,{255,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,255,0}}},
			{{0,-1},  {col,{255,255,0}}},
			{{1,-1},  {col,{255,255,0}}},
			{{-1,0},  {col,{255,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,255,0}}},
			{{0,-1},  {col,{255,255,0}}},
			{{1,-1},  {col,{255,255,0}}},
			{{-1,0},  {col,{255,255,0}}},
			{{0,0},   {col,{255,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,255,0}}},
			{{0,-1},  {col,{255,255,0}}},
			{{1,-1},  {col,{255,255,0}}},
			{{-1,0},  {col,{255,255,0}}},
			{{1,0},   {col,{255,255,0}}}
			]},

		{false, [
			{{-1,-1}, {col,{255,255,255}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,255,255}}},
			{{0,-1},  {col,{255,255,255}}}
			]},
		{{col,{255,255,255}}, [
			{{-1,-1}, {col,{255,255,255}}},
			{{0,-1},  {col,{255,255,255}}},
			{{0,0},   {col,{255,255,255}}}
			]},
		{{col,{255,255,255}}, [
			{{-1,-1}, {col,{255,255,255}}},
			{{0,-1},  {col,{255,255,255}}},
			{{1,-1},  {col,{255,255,255}}}
			]},
		{{col,{255,255,255}}, [
			{{-1,-1}, {col,{255,255,255}}},
			{{0,-1},  {col,{255,255,255}}},
			{{1,-1},  {col,{255,255,255}}},
			{{0,0},   {col,{255,255,255}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,255,255}}},
			{{0,-1},  {col,{255,255,255}}},
			{{1,-1},  {col,{255,255,255}}},
			{{-1,0},  {col,{255,255,255}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,255,255}}},
			{{0,-1},  {col,{255,255,255}}},
			{{1,-1},  {col,{255,255,255}}},
			{{-1,0},  {col,{255,255,255}}},
			{{0,0},   {col,{255,255,255}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,255,255}}},
			{{0,-1},  {col,{255,255,255}}},
			{{1,-1},  {col,{255,255,255}}},
			{{-1,0},  {col,{255,255,255}}},
			{{1,0},   {col,{255,255,255}}}
			]},

		{false, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}}
			]},
		{false, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}}
			]},
		{{col,{255,0,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}},
			{{0,1},   {col,{255,0,0}}}
			]},
		{{col,{0,255,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}},
			{{0,1},   {col,{0,255,0}}}
			]},
		{{col,{0,0,255}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}},
			{{0,1},   {col,{0,0,255}}}
			]},
		{{col,{255,0,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}},
			{{0,0},   {col,{255,0,0}}}
			]},
		{{col,{0,255,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}},
			{{0,0},   {col,{0,255,0}}}
			]},
		{{col,{0,0,255}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}},
			{{0,0},   {col,{0,0,255}}}
			]},
		{{col,{255,0,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}},
			{{0,0},   {col,{255,0,0}}},
			{{0,1},   {col,{255,0,0}}}
			]},
		{{col,{0,255,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}},
			{{0,0},   {col,{0,255,0}}},
			{{0,1},   {col,{0,255,0}}}
			]},
		{{col,{0,0,255}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{0,255,0}}},
			{{1,-1},  {col,{0,0,255}}},
			{{-1,0},  {col,{255,0,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,0,255}}},
			{{0,0},   {col,{0,0,255}}},
			{{0,1},   {col,{0,0,255}}}
			]},

		{{col,{255,255,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{255,0,0}}},
			{{1,-1},  {col,{255,0,0}}},
			{{-1,0},  {col,{0,255,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,255,0}}}
			]},
		{{col,{255,255,255}}, [
			{{-1,-1}, {col,{255,0,255}}},
			{{0,-1},  {col,{255,0,255}}},
			{{1,-1},  {col,{255,0,255}}},
			{{-1,0},  {col,{0,255,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,255,0}}}
			]},

		{{col,{255,255,40}}, [
			{{-1,-1}, {col,{255,0,120}}},
			{{0,-1},  {col,{255,0,0}}},
			{{1,-1},  {col,{255,0,0}}},
			{{-1,0},  {col,{0,255,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,255,0}}}
			]},
		{{col,{0,255,0}}, [
			{{-1,-1}, {col,{255,0,168}}},
			{{0,-1},  {col,{255,0,0}}},
			{{1,-1},  {col,{255,0,0}}},
			{{-1,0},  {col,{0,255,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,255,0}}}
			]},
		{{col,{255,255,0}}, [
			{{-1,-1}, {col,{255,0,0}}},
			{{0,-1},  {col,{255,0,0}}},
			{{1,-1},  {col,{255,0,0}}},
			{{-1,0},  {col,{0,255,0}}},
			{{1,0},   {col,{0,255,0}}},
			{{-1,1},  {col,{0,255,0}}}
			]}

]).


test_calc(_Config) ->

	Expectations = ?calc_expectations,

	lists:foreach(
		fun ({Expected, FieldUpdates}) ->
			Field1 = cgolam_field_ets:new([{width, 4}, {height, 4}]),
			Rules = cgolam_rules_species1:new([{field, cgolam_field_ets}]),
			Field2 = lists:foldl(
				fun ({{X, Y}, CellState}, Field1Acc) ->
					cgolam_field_ets:set(Field1Acc, X, Y, CellState)
					end,
				Field1,
				FieldUpdates
			),
			Calc = cgolam_rules_species1:calc(Rules, Field2, 0, 0),
			if Expected /= Calc -> throw({{expected, Expected}, {calculated, Calc}, {field, FieldUpdates}});
				true -> ok end
			end,
		Expectations
	)
.
